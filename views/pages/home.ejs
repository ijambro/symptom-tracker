<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("../partials/head"); %>
        <link href="/css/home.css" rel="stylesheet" type="text/css">
        <link href="/css/footer.css" rel="stylesheet" type="text/css">
</head>

<body>

    <%- include("../partials/header"); %>

    <main class="container">

        <ul class="collapsible">
            <li>
                <div class="collapsible-header"><i class="material-icons pink-text text-accent-2">signal_cellular_connected_no_internet_4_bar</i>Pain</div>
                <div class="collapsible-body">

                    <form action="/metrics/pain">
                        <div class="row">
                            Enter your pain level, darling:
                        </div>
                
                        <div class="row">
                            <p class="range-field">
                                <input type="range" name="level" min="0" max="10" />
                            </p>
                        </div>
                        
                        <div class="row">
                            <div class="col right">
                                <button class="btn pink accent-2 waves-effect waves-light" type="submit">
                                    Record
                                    <i class="material-icons right">send</i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons pink-text text-accent-2">filter_drama</i>Gas</div>
                <div class="collapsible-body">

                    <form action="/metrics/gas">
                        <div class="row">
                            Are you gassy, my love?
                        </div>
                
                        <div class="row">
                            <p class="range-field">
                                <input type="range" name="level" min="0" max="2" />
                            </p>
                        </div>

                        <div class="row">
                            <div class="col right">
                                <button class="btn pink accent-2 waves-effect waves-light" type="submit">
                                    Record
                                    <i class="material-icons right">send</i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>
            <li>
                <div class="collapsible-header"><i class="material-icons pink-text text-accent-2">whatshot</i>Poop</div>
                <div class="collapsible-body">

                    <form action="/metrics/poop">
                        <div class="row">
                            <div class="switch">
                                <label>
                                    No poop (decoy)
                                    <input type="checkbox" name="pooped">
                                    <span class="lever pink accent-2"></span>
                                    Yes, there were ploops and plops!
                                </label>
                            </div>
                        </div>
                        <div class="row">
                            Consistency
                            <div class="input-field col s12">
                                <select name="consistency" class="browser-default">
                                    <option value="4">Diarrhea</option>
                                    <option value="3" selected>Loose</option>
                                    <option value="2">Medium</option>
                                    <option value="1">Firm</option>
                                </select>
                                <!-- <label>Consistency</label> -->
                                </div>
                        </div>

                        <div class="row">
                            <p>
                                <label>
                                    <input type="checkbox" name="urgent" />
                                    <span>Urgent</span>
                                </label>
                            </p>
                            <p>
                                <label>
                                    <input type="checkbox" name="explosive" />
                                    <span>Explosive</span>
                                </label>
                            </p>
                            <p>
                                <label>
                                    <input type="checkbox" name="blood" />
                                    <span>Has Blood</span>
                                </label>
                            </p>
                        </div>
                        
                        <div class="row">
                            Minutes in bathroom
                        </div>
                        <div class="row">
                            <p class="range-field">
                                <input type="range" name="duration" min="0" max="30" />
                            </p>
                        </div>

                        <div class="row">
                            <div class="col right">
                                <button class="btn pink accent-2 waves-effect waves-light" type="submit">
                                    Record
                                    <i class="material-icons right">send</i>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </li>
        </ul>

    </main>

    <%- include("../partials/footer"); %>

</body>

<script type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {
    let elems = document.querySelectorAll(".collapsible");
    M.Collapsible.init(elems, {});

    elems = document.querySelectorAll("select");
    M.FormSelect.init(elems, {});
});

// Change all form submits to make async post instead
// https://pqina.nl/blog/async-form-posts-with-a-couple-lines-of-vanilla-javascript/
document.querySelectorAll("form").forEach(form => {
    form.addEventListener("submit", e => {
        const form = e.target;
        console.log("Form submitted!");
        const formFieldsAsObject = Object.fromEntries(new FormData(form).entries());
        console.log(formFieldsAsObject);

        // Post data using the Fetch API
        fetch(form.action, {
            method: "POST",
            body: JSON.stringify(formFieldsAsObject),
            headers: {"Content-Type": "application/json"}
        });
        //then
        M.toast({html: "Successfully recorded!  Great job, you!", classes: "rounded green accent-3"})
        //catch
        // M.toast({html: "Connection error. Please try again later.", classes: "rounded pink accent-2"})

        // Prevent the default form submit to stay on this page
        e.preventDefault();
    });
});

</script>

</html>